(function(f){"use strict";var $=Object.defineProperty,m=Object.getOwnPropertySymbols,_=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable,g=(t,n,e)=>n in t?$(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e,y=(t,n)=>{for(var e in n||(n={}))_.call(n,e)&&g(t,e,n[e]);if(m)for(var e of m(n))C.call(n,e)&&g(t,e,n[e]);return t};const p=(t="always")=>({playMode:t,createContainers:!0,hideOverflow:!1,timing:t==="always"?{duration:2*1e3,iterations:1/0}:{duration:250,iterations:1},glitchTimeSpan:t==="always"?{start:.5,end:.7}:{start:0,end:1},shake:{velocity:15,amplitudeX:.2,amplitudeY:.2},slice:t==="click"?{count:15,velocity:20,minHeight:.02,maxHeight:.15,hueRotate:!0}:{count:6,velocity:15,minHeight:.02,maxHeight:.15,hueRotate:!0}}),v=(t,n)=>{if(!t.glitchTimeSpan)return 1;const e=t.glitchTimeSpan.start,a=t.glitchTimeSpan.end;if(n<e||n>a)return 0;const r=e+(a-e)/2;return n<r?(n-e)/(r-e):(a-n)/(a-r)},u=(t,n)=>(Math.random()-.5)*2*v(t,n),A=({minHeight:t,maxHeight:n,minWidth:e,maxWidth:a})=>{const r=Math.floor(Math.random()*((n-t)*100+1))+t*100,c=Math.floor(Math.random()*((a-e)*100+1))+e*100,i=Math.floor(Math.random()*(100-r)),o=Math.floor(Math.random()*(100-c)),h=`${o+c}% ${i}%`,s=`${o+c}% ${i+r}%`,l=`${o}% ${i+r}%`,d=`${o}% ${i}%`;return`polygon(${h},${s},${l},${d})`},M=t=>{const n=Math.floor(t.slice.velocity*t.timing.duration/1e3)+1,e=[];for(let a=0;a<n;++a){if(v(t,a/n)===0){e.push({opacity:"0",transform:"",clipPath:"unset"});continue}const r=u(t,a/n)*30,c={opacity:"1",transform:`translate3d(${r}%,0,0)`,clipPath:A({minHeight:t.slice.minHeight,maxHeight:t.slice.maxHeight,minWidth:1,maxWidth:1})};t.slice.hueRotate&&(c.filter=`hue-rotate(${Math.floor(u(t,a/n)*360)}deg)`),e.push(c)}return{steps:e,timing:y({easing:`steps(${n},jump-start)`},t.timing)}},b=t=>{if(!t.shake)return{steps:[],timing:{}};const n=Math.floor(t.shake.velocity*t.timing.duration/1e3)+1,e=[];for(let a=0;a<n;++a){const r=u(t,a/n)*t.shake.amplitudeX*100,c=u(t,a/n)*t.shake.amplitudeY*100;e.push({transform:`translate3d(${r}%,${c}%,0)`})}return{steps:e,timing:y({easing:`steps(${n},jump-start)`},t.timing)}},w=t=>[b(t),...Array.from({length:t.slice.count}).map(()=>M(t))],E=(...t)=>{const n=e=>e&&typeof e=="object";return t.reduce((e,a)=>(Object.keys(a).forEach(r=>{const c=e[r],i=a[r];if(Array.isArray(c)&&Array.isArray(i)){e[r]=c.concat(...i);return}if(n(c)&&n(i)){e[r]=E(c,i);return}i!==void 0&&(e[r]=i)}),e),{})},G=(t,n)=>{var e,a;if(!n.createContainers)return{container:t,layersContainer:t,glitched:t.firstElementChild};if(!t.dataset.glitched){const i=document.createElement("div"),o=document.createElement("div");return getComputedStyle(t).getPropertyValue("display").match(/^inline/)&&(o.style.display="inline-block"),o.appendChild(i),(e=t.parentElement)==null||e.insertBefore(o,t),i.prepend(t),{container:o,layersContainer:i,glitched:t}}const r=t.parentElement,c=(a=t.parentElement)==null?void 0:a.parentElement;for(;r.children.length>1;)r.removeChild(r.children[1]);return r.firstElementChild.getAnimations().forEach(i=>i.cancel()),{container:c,layersContainer:r,glitched:t}},P=(t,n,e)=>{const{glitched:a,container:r,layersContainer:c}=G(t,e);c.style.display="grid",e.hideOverflow&&(r.style.overflow="hidden"),e.html&&(a.innerHTML=e.html),a.style.gridArea="1/1/-1/-1";const i=a.cloneNode(!0);i.style.gridArea="1/1/-1/-1",i.style.userSelect="none",i.style.pointerEvents="none",i.style.opacity="0";for(let s=0;s<n.length-1;++s){const l=i.cloneNode(!0);c.appendChild(l)}const o=()=>{n.forEach((s,l)=>{c.children[l].animate(s.steps,s.timing)})},h=()=>{n.forEach((s,l)=>{c.children[l].getAnimations().forEach(d=>{d.cancel()})})};switch(r.onmouseenter=null,r.onmouseleave=null,r.onclick=null,e.playMode){case"always":o();break;case"hover":r.onmouseenter=o,r.onmouseleave=h;break;case"click":r.onclick=()=>{h(),o()};break}return t.dataset.glitched="1",{container:r,startGlitch:o,stopGlitch:h}},k={glitch:(t=".powerglitch",n={})=>{const e=E(p(n.playMode),n);let a=[];typeof t=="string"?a=Array.from(document.querySelectorAll(t)):t instanceof NodeList?a=Array.from(t):Array.isArray(t)?a=t:t instanceof HTMLElement&&(a=[t]);const r=w(e),c=a.map(i=>P(i,r,e));return{containers:c.map(i=>i.container),startGlitch:()=>c.forEach(i=>i.startGlitch()),stopGlitch:()=>c.forEach(i=>i.stopGlitch())}},generateLayers:w,getDefaultOptions:p};f.PowerGlitch=k,Object.defineProperty(f,"__esModule",{value:!0})})(this.window=this.window||{});
